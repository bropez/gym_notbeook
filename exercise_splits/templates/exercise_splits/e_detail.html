{% extends 'exercise_splits/base.html' %}

{% block title_block %}Exercise Detail{% endblock %}

{% block style_block %}
<script>
    function showMe(clicked_id) {
        let pounds_id = "pounds" + clicked_id;
        let pounds_thing = document.getElementById(pounds_id);
        let poundsThingClass = pounds_thing.className;
        
        let rep_id = "reps" + clicked_id;
        let rep_thing = document.getElementById(rep_id);
        let repThingClass = rep_thing.className;

        if (poundsThingClass === 'hidden') {
            pounds_thing.className = 'block text-center';
            rep_thing.className = 'block text-center';
        }
        else {
            pounds_thing.className = 'hidden';
            rep_thing.className = 'hidden';
        }
    }
</script>
{% endblock %}

{% block body_block %}
    {% load exercise_tags %}

    <p id="demo"></p>
    <h1 id="start_countdown">Start</h1>

    {% if ex.set_set.all %}
    <!-- TODO: change this to accommodate for bodyweight vs weight
    TODO: change this to accommodate for timed exercises -->
        <h3 class="p-1">{{ ex.exercise_name }} at {{ ex.top_weight }} on {{ ex.workout_day }}</h3>
        <div class="w-2/4 flex mb-4">
            <div class="w-1/2 p-2">
            <h1 class="text-left border-b-4 border-green-300">{{ ex }} Sets</h1>
                <ul>
                    {% for set in ex.set_set.all %}
                        <li class="text-center">
                            <a href="{% url 'workouts:s_update' ex.id set.id %}" class="text-lg"><i class="fa fa-edit"></i></a>
                            <span onclick="showMe(this.id)" id="{{ forloop.counter }}" class="text-lg">Set {{ forloop.counter }}</span>
                            {% comment %} <a href="{% url 'workouts:s_detail' ex.id set.id forloop.counter %}" class="text-lg">Set number {{ forloop.counter }} at {{ set.weight_in_lbs }}</a> {% endcomment %}
                            <p id="pounds{{ forloop.counter }}" class="hidden">weight: {{ set.weight_in_lbs }}lbs</p>
                            <p id="reps{{ forloop.counter }}" class="hidden">reps: {{ set.repetitions }}</p>
                        </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="w-1/2 p-2">
                <h3 class="text-left border-b-4 border-green-300">{{ ex }} Details</h3>
                <p>Bar Type: {{ ex.get_bar_type_display }}</p>
                <p>Sets completed: {{ ex.set_set.count }}</p>

                {% if ex.set_set.all %}
                    <p>Top Weight: {{ ex|get_max_lbs }}</p>
                {% endif %}
                
                <div class="my-2">
                    <a 
                    href="{% url 'workouts:s_create' ex.id %}"
                    class="border border-blue-700 rounded-lg pb-1 px-2 bg-green-300 text-blue-900 text-lg"
                    >
                        <i class="fa fa-plus-square-o"></i>
                        Create a new set
                    </a>
                </div>

                <div class="my-2">
                    <a
                    href="{% url 'workouts:wd_detail' ex.workout_day.id %}"
                    class="border border-gray-500 bg-gray-500 rounded-lg px-2 my-1 text-lg"
                    >
                        Back to workout day
                    </a>
                </div>
            </div>
        </div>
    {% else %}
        <h3>No exercises available.</h3>
        <a 
        href="{% url 'workouts:s_create' ex.id %}"
        class="border border-blue-700 rounded-lg pb-1 px-2 bg-green-300 text-blue-900 text-lg"
        >
            <i class="fa fa-plus-square-o"></i>
            Let's start with a new set!
        </a>

        <a
        href="{% url 'workouts:wd_detail' ex.workout_day.id %}"
        class="border border-gray-500 bg-gray-500 rounded-lg px-2 my-1 text-lg"
        >
            Back to workout day details
        </a>
    {% endif %}

    <script>
        function add_time(time_to_go) {
            // TODO: create an html element to input how much time to wait
            // TODO: make it settable for minutes and seconds
            // Set the date we're counting down to
            var countDown = new Date();
            var time_to_go = time_to_go;
            var countDownDate = new Date(countDown.setTime(countDown.getTime() + (time_to_go * 1000)));
            countDownDate = countDownDate.getTime();

            return countDownDate;
        }

        // Update the count down every 1 second
        function start_countdown() {
            var time_to_go = 45;
            var countDownDate = add_time(time_to_go);

            var x = setInterval(function() {
                // Get today's date and time
                var now = new Date().getTime();
                    
                // Find the distance between now and the count down date
                var distance = countDownDate - now;
                    
                // Time calculations for days, hours, minutes and seconds
                var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                    
                // Output the result in an element with id="demo"
                document.getElementById("demo").innerHTML = days + "d " + hours + "h "
                + minutes + "m " + seconds + "s ";
                    
                // If the count down is over, write some text 
                if (distance < 0) {
                    clearInterval(x);
                    document.getElementById("demo").innerHTML = "EXPIRED";
                }
            }, 1000);
        }

        document.getElementById("start_countdown").onclick = function() {start_countdown()};
    </script>
{% endblock %}